<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manajemen Inventaris Sekolah</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- React & ReactDOM (Development UMD) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      body { font-family: 'Inter', sans-serif; }
      /* Custom scrollbar for table responsiveness */
      .scrollbar-hide::-webkit-scrollbar {
          display: none;
      }
      .scrollbar-hide {
          -ms-overflow-style: none;
          scrollbar-width: none;
      }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/"
  }
}
</script>
</head>
<body class="bg-gray-50 text-gray-900">
    <div id="root"></div>

    <script type="text/babel">
        // --- CONSTANTS ---
        // Ganti URL ini dengan URL Web App dari Google Apps Script Anda
        const API_URL = "https://script.google.com/macros/s/AKfycby0AguiPkCCQdHKh2jk7K3GsuzoigWYoY44HRr33N3O-oofo1kb_HK74a49dfOgeFowhw/exec";

        const ADMIN_PASSWORD = "admin123";

        const GURU_LIST = [
          "Indah Sari, S.Pd., M.Pd.",
          "Rosnina Ruslan, S.Pd.",
          "Vivi Angraeni, S.Pd.",
          "Wahdania, S.Pd.",
          "Nur Fitriani, S.Pd.I",
          "Anriana, S.Pd.",
          "Nur Asura, S.Pd.",
          "Rifka Mulyani Jamil, S.Pd.",
          "Muhammad Rate, S.Pd.",
          "Sri Indriani, S.Pd., Gr.",
          "A. Fifin Kamriani, S.P.",
          "Zahra Karimah Tunnisa, S.Pd.",
          "Nur Ariani Amir, S.Pd.",
          "Siswandi Zikrullah",
          "La Ode Hermawan Rauf, S.Pd.",
          "Hasanuddin, S.Pd.",
          "Haaniyah Bintu Kasman, S.Pd.",
          "Darmawati Saleh, S.Pd.",
          "M. Alimin, S.Pd.I.",
          "Soekarno, S.Pd.",
          "Sumarni, S.Pd.",
          "Nurfatia, S.Hum.",
          "Muhammad Asrar Idrus, S.Pd.",
          "Sri Nikmayanti, S.Pd.",
          "Muhammad Rusdi Syam, S.E.",
          "Nur Fadillah Musfira, S.Pd.",
          "M. Anshar Gaffar, S.Sos.",
          "Alwi Firsadi, S.Kom."
        ];

        // --- SERVICES ---
        const request = async (action, payload) => {
            if (API_URL === "INSERT_YOUR_GOOGLE_SCRIPT_URL_HERE") {
                console.warn("API URL not configured.");
                return { status: 'error', message: 'API URL not configured.' };
            }

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' }, // text/plain to avoid CORS preflight
                    body: JSON.stringify({ action, ...payload }),
                });
                
                const data = await response.json();
                return data;
            } catch (error) {
                console.error("API Error:", error);
                return { status: 'error', message: String(error) };
            }
        };

        const SheetService = {
            getAllData: async () => {
                const result = await request('getAll');
                if (result.status === 'success') {
                    return result.data;
                }
                return null;
            },

            create: async (type, data) => {
                return await request('create', { type, data });
            },

            update: async (type, data) => {
                return await request('update', { type, data });
            },

            delete: async (type, id) => {
                return await request('delete', { type, id });
            },
            
            requestDelete: async (type, id) => {
                return await request('update', { type, data: { id, deleteRequested: true } });
            }
        };

        // --- COMPONENTS ---
        
        // Table Component
        const Table = ({ data, columns, actions, emptyMessage = "Tidak ada data." }) => {
            if (data.length === 0) {
                return <div className="p-8 text-center text-gray-500 border rounded-lg bg-white text-sm">{emptyMessage}</div>;
            }

            return (
                <div className="overflow-x-auto shadow-sm border rounded-lg">
                    <table className="w-full text-sm text-left text-gray-500">
                        <thead className="text-xs text-white uppercase bg-indigo-600">
                            <tr>
                                {columns.map((col, idx) => (
                                    <th key={idx} className={`px-3 py-2 md:px-6 md:py-3 whitespace-nowrap ${col.className || ''}`}>{col.header}</th>
                                ))}
                                {actions && <th className="px-3 py-2 md:px-6 md:py-3 text-right whitespace-nowrap">Aksi</th>}
                            </tr>
                        </thead>
                        <tbody className="bg-white divide-y divide-gray-200">
                            {data.map((item) => (
                                <tr key={item.id} className="hover:bg-gray-50">
                                    {columns.map((col, idx) => (
                                        <td key={idx} className="px-2 py-2 md:px-6 md:py-4 whitespace-nowrap font-medium text-gray-900">
                                            {col.accessor(item)}
                                        </td>
                                    ))}
                                    {actions && (
                                        <td className="px-2 py-2 md:px-6 md:py-4 text-right whitespace-nowrap space-x-2">
                                            {actions(item)}
                                        </td>
                                    )}
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            );
        };

        // Modal Component
        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4">
                    <div className="bg-white rounded-lg shadow-xl w-full max-w-md overflow-hidden transform transition-all max-h-[90vh] flex flex-col">
                        <div className="px-6 py-4 border-b flex justify-between items-center shrink-0">
                            <h3 className="text-lg font-bold text-gray-900">{title}</h3>
                            <button onClick={onClose} className="text-gray-400 hover:text-gray-500">
                                <svg className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                        <div className="p-6 overflow-y-auto">
                            {children}
                        </div>
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        
        // Helper Functions
        const formatDate = (dateStr) => {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return new Intl.DateTimeFormat('id-ID').format(date);
        };

        const formatCurrency = (value) => {
            if (!value) return 'Rp. 0';
            const clean = String(value).replace(/\D/g, '');
            return 'Rp. ' + clean.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        };

        const App = () => {
            const [activeTab, setActiveTab] = React.useState(1);
            const [isLoading, setIsLoading] = React.useState(false);
            const [isAdminOpen, setIsAdminOpen] = React.useState(false);
            const [adminAuth, setAdminAuth] = React.useState(false);
            const [passwordInput, setPasswordInput] = React.useState("");
            const [passwordError, setPasswordError] = React.useState("");

            // Data State
            const [data, setData] = React.useState({
                lcd: [],
                laptop: [],
                pengajuan: [],
                bukuSisa: [],
                bukuHarga: []
            });

            // Form States
            const [lcdForm, setLcdForm] = React.useState({ jenis: 'LCD', tanggal: '', kelas: '', jamPelajaran: '' });
            const [laptopForm, setLaptopForm] = React.useState({ laptopKe: '', tanggal: '', guru: '' });
            const [pengajuanForm, setPengajuanForm] = React.useState({ mapel: '', jumlah: '', kelas: '', namaSiswa: '' });
            
            // Modals
            const [editModal, setEditModal] = React.useState(null);
            const [deleteConfirm, setDeleteConfirm] = React.useState(null);

            const fetchData = React.useCallback(async () => {
                setIsLoading(true);
                try {
                    const result = await SheetService.getAllData();
                    if (result) {
                        setData(result);
                    }
                } catch (e) {
                    console.error("Failed to fetch data", e);
                } finally {
                    setIsLoading(false);
                }
            }, []);

            React.useEffect(() => {
                fetchData();
            }, [fetchData]);

            const handleRefresh = () => fetchData();

            // --- Form Handlers ---
            const handleLcdSubmit = async (e) => {
                e.preventDefault();
                setIsLoading(true);
                
                // Tambahkan koma atas (') untuk memaksa format teks di Google Sheet
                const payload = {
                    ...lcdForm,
                    jamPelajaran: `'${lcdForm.jamPelajaran}`
                };

                await SheetService.create('lcd', payload);
                setLcdForm({ jenis: 'LCD', tanggal: '', kelas: '', jamPelajaran: '' });
                await fetchData();
            };

            const handleLaptopSubmit = async (e) => {
                e.preventDefault();
                setIsLoading(true);
                await SheetService.create('laptop', laptopForm);
                setLaptopForm({ laptopKe: '', tanggal: '', guru: '' });
                await fetchData();
            };

            const handlePengajuanSubmit = async (e) => {
                e.preventDefault();
                setIsLoading(true);
                await SheetService.create('pengajuan', { ...pengajuanForm, status: 'Tidak Ada' });
                setPengajuanForm({ mapel: '', jumlah: '', kelas: '', namaSiswa: '' });
                await fetchData();
            };

            // --- Action Handlers ---
            const handleDeleteRequest = async () => {
                if (!deleteConfirm) return;
                setIsLoading(true);
                await SheetService.requestDelete(deleteConfirm.type, deleteConfirm.id);
                setDeleteConfirm(null);
                await fetchData();
            };

            const handleEditSave = async (e) => {
                e.preventDefault();
                if (!editModal) return;
                setIsLoading(true);
                
                let dataToSave = editModal.data;
                // Preserve apostrophe for LCD Jam
                if (editModal.type === 'lcd' && !dataToSave.jamPelajaran.startsWith("'")) {
                    dataToSave = { ...dataToSave, jamPelajaran: `'${dataToSave.jamPelajaran}` };
                }

                await SheetService.update(editModal.type, dataToSave);
                setEditModal(null);
                await fetchData();
            };

            const handleAdminLogin = (e) => {
                e.preventDefault();
                if (passwordInput === ADMIN_PASSWORD) {
                    setAdminAuth(true);
                    setPasswordError("");
                    setIsAdminOpen(true);
                } else {
                    setPasswordError("Password salah!");
                }
            };

            // --- RENDER TAB CONTENT ---
            
            const renderLcdTab = () => (
                <div className="space-y-6">
                    <div className="bg-white p-4 md:p-6 rounded-lg shadow-sm border border-gray-200">
                        <h3 className="text-lg font-bold text-gray-800 mb-4">Tambah Data LCD / PID</h3>
                        <form onSubmit={handleLcdSubmit} className="grid grid-cols-1 md:grid-cols-5 gap-4">
                            <select 
                                className="border p-2 rounded w-full text-sm"
                                value={lcdForm.jenis}
                                onChange={e => setLcdForm({...lcdForm, jenis: e.target.value})}
                            >
                                <option value="LCD">LCD</option>
                                <option value="PID">PID</option>
                            </select>
                            <input 
                                type="date" 
                                className="border p-2 rounded w-full text-sm" 
                                required
                                value={lcdForm.tanggal}
                                onChange={e => setLcdForm({...lcdForm, tanggal: e.target.value})}
                            />
                            <select 
                                className="border p-2 rounded w-full text-sm" 
                                required
                                value={lcdForm.kelas}
                                onChange={e => setLcdForm({...lcdForm, kelas: e.target.value})}
                            >
                                <option value="">Pilih Kelas</option>
                                {[...Array(6)].map((_, i) => 
                                    ['A','B','C','D'].map(char => (
                                        <option key={`${i+1}${char}`} value={`${i+1} ${char}`}>{i+1} {char}</option>
                                    ))
                                )}
                            </select>
                            <input 
                                type="text" 
                                placeholder="Jam ke... (1-2)" 
                                className="border p-2 rounded w-full text-sm" 
                                required
                                value={lcdForm.jamPelajaran}
                                onChange={e => setLcdForm({...lcdForm, jamPelajaran: e.target.value})}
                            />
                            <button disabled={isLoading} className="bg-indigo-600 text-white p-2 rounded hover:bg-indigo-700 disabled:bg-indigo-300 w-full text-sm font-medium">
                                {isLoading ? '...' : 'Tambah'}
                            </button>
                        </form>
                    </div>

                    <Table
                        data={data.lcd.filter(x => !x.deleteRequested)}
                        columns={[
                            { header: 'Jenis', accessor: (item) => <span className={`px-2 py-1 rounded text-xs font-bold ${item.jenis === 'LCD' ? 'bg-blue-100 text-blue-800' : 'bg-purple-100 text-purple-800'}`}>{item.jenis}</span> },
                            { header: 'Tanggal', accessor: (item) => formatDate(item.tanggal) },
                            { header: 'Kelas', accessor: (item) => item.kelas },
                            { header: 'Jam', accessor: (item) => item.jamPelajaran },
                        ]}
                        actions={(item) => (
                            <div className="flex justify-end gap-2">
                                <button onClick={() => setEditModal({ open: true, type: 'lcd', data: { ...item } })} className="text-blue-600 hover:underline text-xs md:text-sm">Edit</button>
                                <button onClick={() => setDeleteConfirm({ open: true, type: 'lcd', id: item.id })} className="text-red-600 hover:underline text-xs md:text-sm">Hapus</button>
                            </div>
                        )}
                    />
                </div>
            );

            const renderLaptopTab = () => (
                <div className="space-y-6">
                    <div className="bg-white p-4 md:p-6 rounded-lg shadow-sm border border-gray-200">
                        <h3 className="text-lg font-bold text-gray-800 mb-4">Tambah Data Laptop</h3>
                        <form onSubmit={handleLaptopSubmit} className="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <select 
                                className="border p-2 rounded w-full text-sm" 
                                required
                                value={laptopForm.laptopKe}
                                onChange={e => setLaptopForm({...laptopForm, laptopKe: e.target.value})}
                            >
                                <option value="">Pilih Laptop</option>
                                {[...Array(10)].map((_, i) => <option key={i} value={`Laptop ${i+1}`}>Laptop {i+1}</option>)}
                            </select>
                            <input 
                                type="date" 
                                className="border p-2 rounded w-full text-sm" 
                                required
                                value={laptopForm.tanggal}
                                onChange={e => setLaptopForm({...laptopForm, tanggal: e.target.value})}
                            />
                            <select 
                                className="border p-2 rounded w-full text-sm" 
                                required
                                value={laptopForm.guru}
                                onChange={e => setLaptopForm({...laptopForm, guru: e.target.value})}
                            >
                                <option value="">Pilih Guru</option>
                                {GURU_LIST.map(g => <option key={g} value={g}>{g}</option>)}
                            </select>
                            <button disabled={isLoading} className="bg-indigo-600 text-white p-2 rounded hover:bg-indigo-700 disabled:bg-indigo-300 w-full text-sm font-medium">
                                {isLoading ? '...' : 'Tambah'}
                            </button>
                        </form>
                    </div>

                    <Table
                        data={data.laptop.filter(x => !x.deleteRequested)}
                        columns={[
                            { header: 'Unit', accessor: (item) => item.laptopKe },
                            { header: 'Tanggal', accessor: (item) => formatDate(item.tanggal) },
                            { header: 'Peminjam', accessor: (item) => item.guru },
                        ]}
                        actions={(item) => (
                            <div className="flex justify-end gap-2">
                                <button onClick={() => setEditModal({ open: true, type: 'laptop', data: { ...item } })} className="text-blue-600 hover:underline text-xs md:text-sm">Edit</button>
                                <button onClick={() => setDeleteConfirm({ open: true, type: 'laptop', id: item.id })} className="text-red-600 hover:underline text-xs md:text-sm">Hapus</button>
                            </div>
                        )}
                    />
                </div>
            );

            const renderBukuTab = () => {
                const renderMatrixTable = (title, tableData, type) => (
                    <div className="mb-8">
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="text-lg font-bold text-gray-800">{title}</h3>
                            <button 
                                onClick={async () => {
                                    setIsLoading(true);
                                    await SheetService.create(type, { mapel: 'Baru', k1: '', k2: '', k3: '', k4: '', k5: '', k6: '' });
                                    await fetchData();
                                }}
                                className="text-xs md:text-sm bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700"
                            >
                                + Baris
                            </button>
                        </div>
                        <div className="overflow-x-auto border rounded-lg shadow-sm">
                            <table className="w-full text-sm text-left text-gray-500">
                                <thead className="text-xs text-white uppercase bg-indigo-600">
                                    <tr>
                                        <th className="px-2 py-2 md:px-4 md:py-3 whitespace-nowrap">Mapel</th>
                                        {[1,2,3,4,5,6].map(k => <th key={k} className="px-2 py-2 md:px-4 md:py-3 text-center whitespace-nowrap">Kls {k}</th>)}
                                        <th className="px-2 py-2 md:px-4 md:py-3 text-right whitespace-nowrap">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody className="bg-white divide-y divide-gray-200">
                                    {tableData.filter(r => !r.deleteRequested).map((row) => (
                                        <tr key={row.id} className="hover:bg-gray-50">
                                            <td className="px-2 py-2 md:px-4 md:py-2 font-medium text-gray-900 cursor-pointer hover:text-indigo-600 whitespace-nowrap" onClick={() => setEditModal({ open: true, type, data: {...row} })}>{row.mapel}</td>
                                            {['k1','k2','k3','k4','k5','k6'].map(k => (
                                                <td key={k} className="px-2 py-2 md:px-4 md:py-2 text-center cursor-pointer hover:bg-indigo-50 whitespace-nowrap text-xs md:text-sm" onClick={() => setEditModal({ open: true, type, data: {...row} })}>
                                                    {type === 'bukuHarga' && row[k] ? formatCurrency(row[k]) : row[k] || '-'}
                                                </td>
                                            ))}
                                            <td className="px-2 py-2 md:px-4 md:py-2 text-right whitespace-nowrap">
                                                <button onClick={() => setDeleteConfirm({ open: true, type, id: row.id })} className="text-red-600 hover:underline text-xs">Hapus</button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                );

                return (
                    <div className="space-y-8">
                        {renderMatrixTable('Daftar Sisa Buku', data.bukuSisa, 'bukuSisa')}
                        {renderMatrixTable('Daftar Harga Buku', data.bukuHarga, 'bukuHarga')}

                        <div className="bg-white p-4 md:p-6 rounded-lg shadow-sm border border-gray-200">
                            <h3 className="text-lg font-bold text-gray-800 mb-4">Form Pengajuan Buku</h3>
                            <form onSubmit={handlePengajuanSubmit} className="grid grid-cols-1 md:grid-cols-5 gap-4">
                                <input 
                                    type="text" placeholder="Mapel" className="border p-2 rounded w-full text-sm" required
                                    value={pengajuanForm.mapel} onChange={e => setPengajuanForm({...pengajuanForm, mapel: e.target.value})}
                                />
                                <input 
                                    type="number" placeholder="Jumlah" className="border p-2 rounded w-full text-sm" required
                                    value={pengajuanForm.jumlah} onChange={e => setPengajuanForm({...pengajuanForm, jumlah: e.target.value})}
                                />
                                <select 
                                    className="border p-2 rounded w-full text-sm" required
                                    value={pengajuanForm.kelas} onChange={e => setPengajuanForm({...pengajuanForm, kelas: e.target.value})}
                                >
                                    <option value="">Pilih Kelas</option>
                                    {[...Array(6)].map((_, i) => 
                                        ['A','B','C','D'].map(char => (
                                            <option key={`${i+1}${char}`} value={`${i+1} ${char}`}>{i+1} {char}</option>
                                        ))
                                    )}
                                </select>
                                <input 
                                    type="text" placeholder="Nama Siswa" className="border p-2 rounded w-full text-sm" required
                                    value={pengajuanForm.namaSiswa} onChange={e => setPengajuanForm({...pengajuanForm, namaSiswa: e.target.value})}
                                />
                                <button disabled={isLoading} className="bg-indigo-600 text-white p-2 rounded hover:bg-indigo-700 disabled:bg-indigo-300 w-full text-sm font-medium">
                                    Ajukan
                                </button>
                            </form>
                        </div>

                        <div className="mt-4">
                            <h3 className="text-lg font-bold text-gray-800 mb-4">Daftar Pengajuan</h3>
                            <Table
                                data={data.pengajuan.filter(x => !x.deleteRequested)}
                                columns={[
                                    { header: 'Mapel', accessor: (item) => item.mapel },
                                    { header: 'Jumlah', accessor: (item) => item.jumlah },
                                    { header: 'Kelas', accessor: (item) => item.kelas },
                                    { header: 'Siswa', accessor: (item) => item.namaSiswa },
                                    { header: 'Status', accessor: (item) => <span className={`px-2 py-1 rounded text-xs ${item.status === 'Sudah Ada' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}`}>{item.status}</span> },
                                ]}
                                actions={(item) => (
                                    <div className="flex justify-end gap-2">
                                        <button disabled={item.status === 'Sudah Ada'} onClick={() => setEditModal({ open: true, type: 'pengajuan', data: { ...item } })} className="text-blue-600 hover:underline disabled:text-gray-400 text-xs md:text-sm">Edit</button>
                                        <button onClick={() => setDeleteConfirm({ open: true, type: 'pengajuan', id: item.id })} className="text-red-600 hover:underline text-xs md:text-sm">Hapus</button>
                                    </div>
                                )}
                            />
                        </div>
                    </div>
                );
            };

            const renderAdminPanel = () => {
                const deletions = [
                    ...data.lcd.filter(x => x.deleteRequested).map(x => ({...x, _type: 'lcd', _desc: `LCD: ${x.jenis} - ${x.tanggal}`})),
                    ...data.laptop.filter(x => x.deleteRequested).map(x => ({...x, _type: 'laptop', _desc: `Laptop: ${x.laptopKe} - ${x.guru}`})),
                    ...data.pengajuan.filter(x => x.deleteRequested).map(x => ({...x, _type: 'pengajuan', _desc: `Pengajuan: ${x.mapel} - ${x.namaSiswa}`})),
                    ...data.bukuSisa.filter(x => x.deleteRequested).map(x => ({...x, _type: 'bukuSisa', _desc: `Sisa Buku: ${x.mapel}`})),
                    ...data.bukuHarga.filter(x => x.deleteRequested).map(x => ({...x, _type: 'bukuHarga', _desc: `Harga Buku: ${x.mapel}`})),
                ];

                const pendingPengajuan = data.pengajuan.filter(x => x.status === 'Tidak Ada' && !x.deleteRequested);

                return (
                    <div className="space-y-8">
                        <div>
                            <h4 className="font-bold text-lg mb-2">Permintaan Hapus ({deletions.length})</h4>
                            {deletions.length === 0 ? <p className="text-gray-500 italic text-sm">Tidak ada permintaan.</p> : (
                                <ul className="space-y-2">
                                    {deletions.map(item => (
                                        <li key={item.id} className="bg-red-50 p-3 rounded border border-red-100 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2">
                                            <span className="text-sm break-words">{item._desc}</span>
                                            <div className="flex gap-2 self-end sm:self-auto shrink-0">
                                                <button 
                                                    onClick={async () => {
                                                        setIsLoading(true);
                                                        await SheetService.update(item._type, { id: item.id, deleteRequested: false });
                                                        await fetchData();
                                                    }}
                                                    className="text-xs bg-gray-200 px-2 py-1 rounded hover:bg-gray-300"
                                                >Tolak</button>
                                                <button 
                                                    onClick={async () => {
                                                        setIsLoading(true);
                                                        await SheetService.delete(item._type, item.id);
                                                        await fetchData();
                                                    }}
                                                    className="text-xs bg-red-600 text-white px-2 py-1 rounded hover:bg-red-700"
                                                >Setujui</button>
                                            </div>
                                        </li>
                                    ))}
                                </ul>
                            )}
                        </div>

                        <div>
                            <h4 className="font-bold text-lg mb-2">Validasi Pengajuan Buku ({pendingPengajuan.length})</h4>
                            {pendingPengajuan.length === 0 ? <p className="text-gray-500 italic text-sm">Semua pengajuan sudah diproses.</p> : (
                                <ul className="space-y-2">
                                    {pendingPengajuan.map(item => (
                                        <li key={item.id} className="bg-yellow-50 p-3 rounded border border-yellow-100 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2">
                                            <span className="text-sm break-words">{item.mapel} - {item.namaSiswa} ({item.jumlah})</span>
                                            <button 
                                                onClick={async () => {
                                                    setIsLoading(true);
                                                    await SheetService.update('pengajuan', { id: item.id, status: 'Sudah Ada' });
                                                    await fetchData();
                                                }}
                                                className="text-xs bg-green-600 text-white px-2 py-1 rounded hover:bg-green-700 self-end sm:self-auto shrink-0"
                                            >Ubah Status Ada</button>
                                        </li>
                                    ))}
                                </ul>
                            )}
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen flex flex-col max-w-6xl mx-auto p-2 md:p-4">
                    {/* Header */}
                    <header className="bg-white rounded-xl shadow-sm p-4 md:p-6 mb-4 md:mb-6 flex flex-col md:flex-row items-center justify-between gap-4">
                        <h1 className="text-xl md:text-2xl font-extrabold text-indigo-900 text-center md:text-left">
                            INVENTARIS & BUKU
                        </h1>
                        <div className="flex items-center gap-2 shrink-0">
                            {API_URL.includes("INSERT") && <span className="text-xs text-red-500 font-bold px-2">⚠️ API URL BELUM DISET</span>}
                            <button onClick={handleRefresh} className="p-2 text-gray-500 hover:bg-gray-100 rounded-full" title="Refresh Data">
                                <svg className={`w-6 h-6 ${isLoading ? 'animate-spin' : ''}`} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
                            </button>
                            <button onClick={() => { setPasswordInput(""); setIsAdminOpen(true); }} className="flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-full transition-colors text-sm font-medium">
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                                Admin
                            </button>
                        </div>
                    </header>

                    {/* Navigation */}
                    <nav className="flex bg-white rounded-t-lg border-b border-gray-200 overflow-hidden shadow-sm">
                        {[
                            { id: 1, label: 'LCD / PID' },
                            { id: 2, label: 'LAPTOP' },
                            { id: 3, label: 'BUKU' },
                        ].map(tab => (
                            <button
                                key={tab.id}
                                onClick={() => setActiveTab(tab.id)}
                                className={`flex-1 py-3 md:py-4 text-xs md:text-sm font-bold tracking-wide transition-colors ${activeTab === tab.id ? 'bg-indigo-50 text-indigo-700 border-b-2 border-indigo-600' : 'text-gray-500 hover:bg-gray-50'}`}
                            >
                                {tab.label}
                            </button>
                        ))}
                    </nav>

                    {/* Content */}
                    <main className="bg-white p-4 md:p-6 rounded-b-lg shadow-sm min-h-[500px]">
                        {activeTab === 1 && renderLcdTab()}
                        {activeTab === 2 && renderLaptopTab()}
                        {activeTab === 3 && renderBukuTab()}
                    </main>

                    {/* --- MODALS --- */}

                    {/* Delete Confirmation */}
                    <Modal 
                        isOpen={!!deleteConfirm} 
                        onClose={() => setDeleteConfirm(null)} 
                        title="Konfirmasi Hapus"
                    >
                        <p className="mb-6 text-gray-600">Apakah Anda yakin ingin mengajukan penghapusan data ini ke Admin?</p>
                        <div className="flex justify-end gap-3">
                            <button onClick={() => setDeleteConfirm(null)} className="px-4 py-2 bg-gray-200 rounded text-gray-700 text-sm">Batal</button>
                            <button onClick={handleDeleteRequest} className="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 text-sm">Ya, Ajukan Hapus</button>
                        </div>
                    </Modal>

                    {/* Edit Modal (Dynamic Form) */}
                    <Modal
                        isOpen={!!editModal}
                        onClose={() => setEditModal(null)}
                        title="Edit Data"
                    >
                        {editModal && (
                        <form onSubmit={handleEditSave} className="space-y-4">
                            {editModal.type === 'lcd' && (
                                <>
                                    <div className="flex flex-col"><label className="text-xs text-gray-500 mb-1">Jenis</label>
                                    <select className="border p-2 rounded text-sm" value={editModal.data.jenis} onChange={e => setEditModal({...editModal, data: {...editModal.data, jenis: e.target.value}})}><option value="LCD">LCD</option><option value="PID">PID</option></select></div>
                                    <div className="flex flex-col"><label className="text-xs text-gray-500 mb-1">Tanggal</label>
                                    <input className="border p-2 rounded text-sm" type="date" value={editModal.data.tanggal.split('T')[0]} onChange={e => setEditModal({...editModal, data: {...editModal.data, tanggal: e.target.value}})} /></div>
                                    <div className="flex flex-col"><label className="text-xs text-gray-500 mb-1">Kelas</label>
                                    <select className="border p-2 rounded text-sm" value={editModal.data.kelas} onChange={e => setEditModal({...editModal, data: {...editModal.data, kelas: e.target.value}})}>
                                        <option value="">Pilih Kelas</option>
                                        {[...Array(6)].map((_, i) => ['A','B','C','D'].map(char => <option key={`${i+1}${char}`} value={`${i+1} ${char}`}>{i+1} {char}</option>))}
                                    </select></div>
                                    <div className="flex flex-col"><label className="text-xs text-gray-500 mb-1">Jam</label>
                                    <input className="border p-2 rounded text-sm" value={editModal.data.jamPelajaran} onChange={e => setEditModal({...editModal, data: {...editModal.data, jamPelajaran: e.target.value}})} /></div>
                                </>
                            )}
                            {editModal.type === 'laptop' && (
                                <>
                                    <div className="flex flex-col"><label className="text-xs text-gray-500 mb-1">Unit</label>
                                    <input className="border p-2 rounded text-sm" value={editModal.data.laptopKe} onChange={e => setEditModal({...editModal, data: {...editModal.data, laptopKe: e.target.value}})} /></div>
                                    
                                    {/* Edit Tanggal Laptop */}
                                    <div className="flex flex-col"><label className="text-xs text-gray-500 mb-1">Tanggal</label>
                                    <input className="border p-2 rounded text-sm" type="date" value={editModal.data.tanggal ? editModal.data.tanggal.split('T')[0] : ''} onChange={e => setEditModal({...editModal, data: {...editModal.data, tanggal: e.target.value}})} /></div>
                                    
                                    <div className="flex flex-col"><label className="text-xs text-gray-500 mb-1">Guru</label>
                                    <select className="border p-2 rounded text-sm" value={editModal.data.guru} onChange={e => setEditModal({...editModal, data: {...editModal.data, guru: e.target.value}})}>
                                        {GURU_LIST.map(g => <option key={g} value={g}>{g}</option>)}
                                    </select></div>
                                </>
                            )}
                            {(editModal.type === 'bukuSisa' || editModal.type === 'bukuHarga') && (
                                <>
                                    <div className="flex flex-col"><label className="text-xs text-gray-500 mb-1">Mapel</label>
                                    <input className="border p-2 rounded text-sm" value={editModal.data.mapel} onChange={e => setEditModal({...editModal, data: {...editModal.data, mapel: e.target.value}})} /></div>
                                    {['k1','k2','k3','k4','k5','k6'].map(k => (
                                        <div key={k} className="flex flex-col"><label className="text-xs text-gray-500 mb-1">Kelas {k.replace('k','')}</label>
                                        <input className="border p-2 rounded text-sm" value={editModal.data[k]} onChange={e => setEditModal({...editModal, data: {...editModal.data, [k]: e.target.value}})} /></div>
                                    ))}
                                </>
                            )}
                            {editModal.type === 'pengajuan' && (
                                <>
                                    <div className="flex flex-col"><label className="text-xs text-gray-500 mb-1">Mapel</label>
                                    <input className="border p-2 rounded text-sm" value={editModal.data.mapel} onChange={e => setEditModal({...editModal, data: {...editModal.data, mapel: e.target.value}})} /></div>
                                    <div className="flex flex-col"><label className="text-xs text-gray-500 mb-1">Jumlah</label>
                                    <input className="border p-2 rounded text-sm" type="number" value={editModal.data.jumlah} onChange={e => setEditModal({...editModal, data: {...editModal.data, jumlah: Number(e.target.value)}})} /></div>
                                    
                                    {/* Edit Kelas dan Siswa */}
                                    <div className="flex flex-col"><label className="text-xs text-gray-500 mb-1">Kelas</label>
                                    <select className="border p-2 rounded text-sm" value={editModal.data.kelas} onChange={e => setEditModal({...editModal, data: {...editModal.data, kelas: e.target.value}})}>
                                        <option value="">Pilih Kelas</option>
                                        {[...Array(6)].map((_, i) => ['A','B','C','D'].map(char => <option key={`${i+1}${char}`} value={`${i+1} ${char}`}>{i+1} {char}</option>))}
                                    </select></div>
                                    <div className="flex flex-col"><label className="text-xs text-gray-500 mb-1">Nama Siswa</label>
                                    <input className="border p-2 rounded text-sm" value={editModal.data.namaSiswa} onChange={e => setEditModal({...editModal, data: {...editModal.data, namaSiswa: e.target.value}})} /></div>
                                </>
                            )}

                            <div className="flex justify-end gap-3 pt-4 border-t mt-2">
                                <button type="button" onClick={() => setEditModal(null)} className="px-4 py-2 bg-gray-200 rounded text-gray-700 text-sm">Batal</button>
                                <button type="submit" className="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 text-sm">Simpan</button>
                            </div>
                        </form>
                        )}
                    </Modal>

                    {/* Admin Modal */}
                    <Modal
                        isOpen={isAdminOpen}
                        onClose={() => setIsAdminOpen(false)}
                        title="Panel Admin"
                    >
                        {!adminAuth ? (
                        <form onSubmit={handleAdminLogin} className="space-y-4">
                            <p className="text-sm text-gray-600">Masukkan password untuk mengakses panel admin.</p>
                            <input 
                                type="password" 
                                className="w-full border p-2 rounded focus:ring-2 focus:ring-indigo-500 outline-none text-sm" 
                                placeholder="Password..."
                                value={passwordInput}
                                onChange={e => setPasswordInput(e.target.value)}
                            />
                            {passwordError && <p className="text-red-500 text-sm">{passwordError}</p>}
                            <div className="flex justify-end">
                                <button type="submit" className="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 text-sm">Login</button>
                            </div>
                        </form>
                        ) : (
                        <div className="max-h-[60vh] pr-2">
                            {renderAdminPanel()}
                            <div className="mt-6 pt-4 border-t text-right">
                                <button onClick={() => setAdminAuth(false)} className="text-sm text-gray-500 underline">Logout</button>
                            </div>
                        </div>
                        )}
                    </Modal>

                </div>
            );
        };

        // Render Root
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
